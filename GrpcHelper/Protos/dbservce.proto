syntax = "proto3";

option csharp_namespace = "GrpcHelper.DbService";
import "google/protobuf/timestamp.proto";

package database;

service Database {
    rpc WriteLog(DbLogModel) returns (WriteLogResponse);
    rpc GetDbLogs(DbLogsRequest) returns (DbLogsResponse);
    rpc AddPost(stream PostModel) returns (Status);
    rpc GetPost(PostRequest) returns (stream PostModel);
    rpc GetImages(ImageRequest) returns (stream Image);
    rpc AddImages(stream ImageModel) returns (Status);
    rpc GetSettings(SettingsRequest) returns (ParserSettings);
    rpc SaveSettings(ParserSettings) returns (Status);
}

message DbLogModel {
    string jsondata = 2;
    google.protobuf.Timestamp timestamp = 5;
}

message WriteLogResponse {
  bool success = 1;
}

message DbLogsRequest {
    repeated DbLogModel logs = 1;
}

message DbLogsResponse {
    DbLogModel filter = 1;
}

message Status {
  bool success = 1;
}

message Image {
  string Name  = 1;
  string Description = 2;
  string OriginalLink = 3;
  bytes File = 4;
  repeated string Tags = 5;
}

message PostModel {
  string Title = 1;
  string Description = 2;
  string Group = 3;
  string UserName = 4;
  string Text = 5;
  repeated Image Images = 6;
  repeated string Tags = 7;
  string Source = 8;
  string OriginalLink = 9;
  google.protobuf.Timestamp PostDate = 10;
}

message PostRequest {
  repeated string Tags = 1;
  string FromSource = 2;
  string ByTitle = 3;
  string ByUserName = 4;
}

message ImageRequest {
  repeated string Tags = 1;
  int32 MaxWidth = 2;
  int32 MaxHeight = 3;
  int32 MinWidth = 4;
  int32 MinHeight = 5;
}

message ImageModel {
  repeated Image Images = 1;
}

message SettingsRequest {
  string Source = 1;
}

message ParserSetting {
    string Id = 1;
    string Description = 2;
    string Source = 3;
    int32 PostsCount = 4;
    string LastPostId = 5;
    bool StartFromPastPost = 6;
    bool ByUpdate = 7;
    int32 Interval = 8;
    int32 JobInterval = 9;
}

message ParserSettings {
  repeated ParserSetting ParserSetting = 1;
}